<script src="https://rawcdn.githack.com/oscarmorrison/md-page/master/md-page.js"></script>

MIDIFAM User Manual
===================

# Overview

The MIDIFAM module is two modules in one, containing both

1. A MIDI interface to control a DFAM sequencer using a single patch cable
2. A dual MIDI-to-CV converter (16-bit DAC per channel) with a robust MIDI implementation including portamento, vibrato, legato (gate vs. trigger), monophonic or duophonic modes, and more 


## MIDI Control of DFAM Sequencer

There are two modes of DFAM sequencer control determined by the *Mode* toggle switch. Control of the DFAM sequencer is handled entirely by the **MIDIFAM's *Adv/Clock* output**.

### ***Note On* Mode**

With the MIDIFAM's toggle switch set to *Note On* you can trigger any individual step of the DFAM sequencer with MIDI *Note On* messages. This gives you the freedom to sequence the DFAM externally or to control the DFAM's sequencer with a keyboard or arpeggiator. Possibilites are unlimited.

The default MIDI channel assigned to the *Adv/Clock* output in *Note On* mode is MIDI channel 10, but this can be re-assigned to any MIDI channel. See the *MIDI Channel Preferences* section below for details.

### ***Clock* Mode**

Set the toggle switch to *Clock* to place the DFAM sequencer under the control of an external MIDI transport. The DFAM sequencer will run according to MIDI Start, Stop, and Continue messages, making the DFAM a MIDI-compliant sequencer (!). When the module receives a MIDI *Start* message, the DFAM sequencer will always begin playing from step 1. On MIDI *Continue* messages, the DFAM sequencer will begin from wherever it left off.

*Clock* mode also features a **clock divider/multiplier** which can be configured using MIDI Control Change messages (CC number 83). Multiply or divide the duration of a DFAM step by a value relative to the MIDI clock. 


## Dual MIDI-to-CV Converter

explain blah blah todo todo todo...
- 16 bit dacs
- MIDI implementations
- polyphony mode

## MIDI Channel Preferences

Press the "Learn" button to set your MIDI channel preferences. The MIDIFAM has three MIDI channel assignments (one for each CV channel and one for the Adv/Clock output) and so there are three selections to make. The selections will be presented in the following order:

1. CV *A*
2. CV *B*
3. DFAM *Note On* mode
    - When the toggle switch is set to *Note On*, DFAM sequencer steps will be triggered by notes received on this MIDI channel

The LEDs will light to indicate which selection is currently active.

To make a MIDI channel selection, **send any Note On message on your chosen MIDI channel**. The module will detect the message and save the MIDI channel on which it was received.

When the selection has been made, the module will automatically advance to the next output and will await a new selection (i.e. any MIDI Note On message on any channel). **To skip to the next selection without changing channel preference, press the "Learn" button again.**

When you have updated (or skipped) all three channel preferences, the module will *store all current configuration* to persistent storage so that your preferences are saved even after power cycling. In addition to saving the MIDI channel selections, **all other settings will also be saved** (e.g. portamento, vibrato, polyphony, and any other configuration made using MIDI CC messages).

By default:
- CV output A receives on MIDI channel #1
- CV output B receives on MIDI channel #2
- DFAM *Note On* mode receives on MIDI channel #10

# DFAM Sequencer Keyboard Mapping

When the toggle switch is set to "Note On", the *Adv/Clock* output will trigger specific steps of the DFAM's sequencer when it receives Note On messages on its assigned MIDI channel. By default, the eight steps of the keystep are triggered by the eight notes of the C Major scale starting on Middle C (midi note number 60). Any note outside of this range will not trigger any 

In order to edit the keyboard mapping, you must **hold the learn button**. 

TODO TODO TODO ....



# Channel-specific CC messages

These will only apply when they are sent on the MIDI channel to which the CV output is assigned.

**Portamento**

|CC | Function           | Values                         | Notes |
|---|--------------------|--------------------------------|-------|
|65  |   Enable or disable portamento | On/Off | |
|18	|   Time (desc.) | 0 to 2 sec | Duration of slides for descending notes |
|19	|   Time (asc.) | 0 to 2 sec |  Duration of slides for ascending notes |
|5	|   Time (master) | 0 to 2 sec | Master duration  |


**Gate/Trig Behavior**

|CC | Function           | Values                         | Notes |
|---|--------------------|--------------------------------|--------- |
|16 | Trigger duration   | 1ms to about 50ms              | |
|80 | Retrigger behavior | Off, Highest, Lowest, Latest   | What note to re-trigger if any notes are still held when a Note Off message is received |
|81 | Gate/Trig mode     | Off, Trigger, Gate             | "Trigger" means a short pulse for every MIDI Note On. "Gate" means the output is high as long as a note is held. |


**Vibrato**

|CC | Function       | Values                         | Notes|
|---|----------------|--------------------------------|-------------|
|76 | Rate           | 5 sec to 200 ms period    |  |
|77 | Depth          | 0 to 1 semitone           | What note to re-trigger if any notes are still held when a Note Off message is received|
|78 | Delay          | 0 to 3 seconds            | How long to wait before beginning the vibrato|

**Pitch Bend**


|CC | Function       | Values                         | Notes|
|---|----------------|--------------------------------|-------------|
|17 | Pitch bend range           | 0 to 12 semitones   |  | 


## Global CC Messages


|CC | Function       | Values                         | Notes|
|---|----------------|--------------------------------|-------------|
|83 | Clock divider  | 1, 2, 3, 4, 6, 8, 12    | Default=4. When the toggle switch is set to "Clock", change the speed of the DFAM sequencer |
|126 | Mono Mode on  |                         | Each CV output is independent and operates as a single monophonic output |
|127 | Poly Mode on  |                         | Both CV outputs are combined for duophony |


## Appendix

### Firmware Update procedure

The module can receive firmware updates via the MIDI input on its front panel. You can download the ``.mid`` file containing the latest firmware from [no link](insert link todo). You will need a device capable of transmitting MIDI "System Exclusive" messages. The software update procedure is as follows:

1. Connect the output of your MIDI device to the MIDI input of the MIDIFAM
2. Power on the MIDIFAM **while holding down both push buttons**
3. All three LEDs will blink red three times indicating that the module has entered self-programming mode.
    - When the top two LEDs turn off and the **bottom LED is green, the module is ready to be updated**.
4. Play the ``.mid`` file
    - The MIDIFAM's bottom LED will blink green to indicate progress

When playback of the ``.mid`` file is complete, the module will restart and is ready for use. 


### V/oct Calibration Procedure

TODO: ...

<script>

window.addEventListener('DOMContentLoaded',function () {
    document.querySelector("h1").style.display = "None"
    document.querySelector("body").style.width = "80%";
    document.querySelector("body").style.margin = "auto";
});




</script>